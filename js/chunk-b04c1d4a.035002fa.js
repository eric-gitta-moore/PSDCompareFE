(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b04c1d4a"],{"192d":function(e,t,a){"use strict";var r=a("c9e1"),s=a("0a63"),n=(a("4ade"),a("b441"));function o({file1:e,file2:t,taskId:a}){let n=new FormData;for(const r of e)n.append("file1",r);for(const r of t)n.append("file2",r);return n.append("taskId",a+""),Object(r["a"])({url:"/file/upload",method:"post",data:n}).then(s["a"].handler)}function i({ids:e}){return n["a"]+"/file/download?id="+e.join("&id=")}function l({ids:e}){return n["a"]+"/taskGroup/download?ids="+e.join("&ids=")}var c={upload:o,download:i,downloadTask:l},d=a("8899");async function u({referenceFiles:e,compareFiles:t,taskId:a}){try{let r=await c.upload({file1:e,file2:t,taskId:a}),s=new d["a"](r.data,r.message,r.code);return s.message}catch(r){return console.log(r.message),r.message}}function h(e){return c.download({ids:e})}function p(e){return c.downloadTask({ids:e})}t["a"]={addCompareGroup:u,getDownloadUrl:h,getTaskDownloadUrl:p}},4746:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("el-container",{staticClass:"main-container"},[t("el-header",[t("el-row",[t("el-col",{attrs:{span:2}},[t("span",[e._v("关键词：")])]),t("el-col",{attrs:{span:3}},[t("el-input",{attrs:{placeholder:"请输入内容",clearable:""},on:{change:e.freshTable},model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}})],1),t("el-col",{attrs:{span:2}},[t("span",[e._v("日期范围：")])]),t("el-col",{attrs:{span:5}},[t("el-date-picker",{attrs:{type:"daterange","unlink-panels":"","range-separator":"~","start-placeholder":"开始日期","end-placeholder":"结束日期"},on:{change:e.freshTable},model:{value:e.daterange,callback:function(t){e.daterange=t},expression:"daterange"}})],1),t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{type:"primary"},on:{click:e.clearAll}},[e._v("重置")])],1),t("el-button",{staticClass:"styleLoad",attrs:{type:"primary"},on:{click:e.downLoadTaskByCheck}},[e._v("下载 ")])],1)],1),t("el-main",{staticClass:"main"},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,"lazy:true":"","row-key":e.getRowKey,"tree-props":{children:"orders",hasChildren:"hasChildren"},"header-row-style":{background:"RGB(246,248,250)"},"header-cell-style":{background:"RGB(246,248,250)"}},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{scopedSlots:e._u([{key:"default",fn:function(a){return[void 0===a.row.serialNumber?t("el-checkbox",{attrs:{indeterminate:a.row.indeterminate},on:{change:function(t){return e.taskGroupCheckId(a.row)}},model:{value:a.row.checked,callback:function(t){e.$set(a.row,"checked",t)},expression:"scope.row.checked"}}):t("el-checkbox",{on:{change:function(t){return e.childCheckAll(a.row)}},model:{value:a.row.checked,callback:function(t){e.$set(a.row,"checked",t)},expression:"scope.row.checked"}})]}}])}),t("el-table-column",{attrs:{prop:"serialNumber",label:"流水编号/任务ID",width:"210"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(void 0!==t.row.serialNumber?t.row.serialNumber:t.row.id)+" ")]}}])}),t("el-table-column",{attrs:{prop:"title",label:"名称",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(void 0!==t.row.serialNumber?t.row.title:t.row.name)+" ")]}}])}),t("el-table-column",{attrs:{prop:"fee",label:"对比费用",width:"150"}}),t("el-table-column",{attrs:{prop:"status",label:"支付状态",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.status)+" ")]}}])}),e._v("z "),t("el-table-column",{attrs:{prop:"status",label:"对比状态",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.result)+" ")]}}])}),t("el-table-column",{attrs:{prop:"status",label:"支付结果",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.status)+" ")]}}])}),t("el-table-column",{attrs:{prop:"createTime",label:"时间",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.createTime)+" ")]}}])}),t("el-table-column",{attrs:{label:"操作",width:"250"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",{staticClass:"act"},[t("svg-icon",{attrs:{"icon-class":"show-eye"}}),t("span",{staticStyle:{cursor:"pointer"},on:{click:function(t){return e.checkTask(a.row)}}},[e._v("查看")]),t("el-divider",{attrs:{direction:"vertical"}}),t("svg-icon",{attrs:{"icon-class":"download"}}),t("span",{staticStyle:{cursor:"pointer"},on:{click:function(t){return e.downLoadTask(a.row)}}},[e._v("下载")]),t("el-divider",{attrs:{direction:"vertical"}}),t("svg-icon",{attrs:{"icon-class":"bin"}}),t("span",{staticStyle:{cursor:"pointer"},on:{click:function(t){return e.deleteTask(a.row.id)}}},[e._v("删除")])],1)]}}])})],1)],1),t("el-footer",[t("el-row",{staticClass:"pagination"},[t("el-col",{attrs:{span:24}},[t("el-pagination",{attrs:{"page-sizes":e.pageSizes,"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total,"current-page":e.currentPage,background:""},on:{"update:pageSize":function(t){e.pageSize=t},"update:page-size":function(t){e.pageSize=t},"current-change":e.freshTable,"size-change":e.freshTable,"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t}}})],1)],1)],1)],1)},s=[],n=(a("cae4"),a("a4e7")),o=a("5042"),i=a("192d"),l=a("80ee"),c={name:"History",components:{},computed:{},methods:{clearAll(){this.searchText="",this.daterange="",this.freshTable()},checkTask(e){let t={};t.taskId=e.taskId?e.taskId:e.id,e instanceof l["a"]||(t.compareId=e.id),this.$router.push({name:"HomeCompareLeft",query:t}),console.log(e)},downLoadTaskByCheck(){let e=this.taskGroupCheck(),t=i["a"].getDownloadUrl(e);window.open(t)},freshTable(){let e,t;this.daterange&&(e=o["a"].format(new Date(this.daterange[0])),t=o["a"].format(new Date(this.daterange[1]))),n["a"].getAll(this.currentPage,this.pageSize,this.searchText,e,t).then(e=>{console.log(e.records),this.total=e.total,e.records=e.records.map((e,t)=>(e.orders=e.orders.map((e,a)=>(this.$set(e,"checked",!1),this.$set(e,"index",a),this.$set(e,"taskIndex",t),e)),e.orders=e.orders.filter(e=>null!==e.id),this.$set(e,"index",t),this.$set(e,"checked",!1),this.$set(e,"indeterminate",!1),e)),this.tableData=e.records,console.log(this.tableData)})},downLoadTask(e){let t=[];t=e instanceof l["a"]?e.orders.map(e=>e.id):[e.id];let a=i["a"].getDownloadUrl(t);window.open(a)},deleteTask(e){let t=this.taskGroupCheck();t.push(e),n["a"].delTaskByIds(t),this.$message.success("删除成功")},handleSelectionChange(e){this.multipleSelection=e},childCheckAll(e){let t=0;this.tableData[e.taskIndex].orders.forEach(e=>{e.checked&&t++}),t===this.tableData[e.taskIndex].orders.length?(this.tableData[e.taskIndex].checked=!0,this.tableData[e.taskIndex].indeterminate=!1):0===t?(this.tableData[e.taskIndex].indeterminate=!1,this.tableData[e.taskIndex].checked=!1):(this.tableData[e.taskIndex].indeterminate=!0,this.tableData[e.taskIndex].checked=!1),console.log(t)},taskGroupCheck(){let e=[];return this.tableData.forEach(t=>{t.orders.forEach(t=>{t.checked&&e.push(t.id)})}),e},taskGroupCheckId(e){this.tableData[e.index].orders.forEach(t=>{t.checked=e.checked}),e.indeterminate=!1},getRowKey(e){return void 0===e.serialNumber?e.id:e.id+"only"}},mounted(){this.freshTable()},data(){return{publicPath:"",daterange:"",searchText:"",pageSizes:[10,20,30,40],pageSize:10,total:100,currentPage:1,tableData:[],IdsArr:[]}}},d=c,u=(a("d832"),a("a9a2")),h=Object(u["a"])(d,r,s,!1,null,"11d829d3",null);t["default"]=h.exports},5042:function(e,t,a){"use strict";function r(e,t="yyyy-MM-dd hh:mm:ss"){var a={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};for(var r in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),a)new RegExp("("+r+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?a[r]:("00"+a[r]).substr((""+a[r]).length)));return t}function s(e,t,a=0){const r=[{unit:"毫秒",multiple:1e3},{unit:"秒",multiple:60},{unit:"分钟",multiple:60},{unit:"小时",multiple:24},{unit:"天"}];let s,n=r[0].unit,o=t-e;if(0===o)return 0;while((s=r.shift())&&s.multiple&&o>s.multiple)o/=s.multiple;return(s.unit===n?o:o.toFixed(a))+s.unit}function n(e,t){var a=new Date(e,t,0);return a.getDate()}function o(e){return!(!parseInt(e)||13!==e.toString().length)}function i(e){return new Date(new Date(e).setHours(0,0,0,0)).getTime()}function l(e){return new Date(new Date(e).setHours(23,59,59,999)).getTime()}t["a"]={format:r,formatDateGap:s,getDaysInOneMonth:n,timeRules:o,setHour0:i,setHour24:l}},"5a04":function(e,t,a){"use strict";class r{constructor({id:e,name:t,taskId:a,size:r,createTime:s,orderId:n}){this.id=e,this.name=t,this.taskId=a,this.size=r,this.createTime=new Date(s),this.orderId=n}}t["a"]=r},"6f08":function(e,t,a){},"80ee":function(e,t,a){"use strict";a("2df5");var r=a("ce79");class s{constructor({id:e,name:t,createTime:a,orders:s}){if(s.length>0&&!(s[0]instanceof r["a"]))throw new Error("orders不是Order实例");this.id=e,this.name=t,this.createTime=a,this.orders=s}}t["a"]=s},a4e7:function(e,t,a){"use strict";var r=a("80ee"),s=a("ce79");class n{constructor(e,t,a,r,s){this.records=e,this.total=t,this.size=a,this.current=r,this.pages=s}}var o=n,i=a("c9e1"),l=a("0a63");a("4ade");function c({groupId:e}){return i["a"].get("/taskGroup/getGroupById",{params:{groupId:e}}).then(l["a"].handler)}function d({keyWords:e=null,startPage:t=1,maxPage:a=5,startTime:r=null,endTime:s=null,sort:n="asc"}){return Object(i["a"])({url:"/taskGroup/getGroups",method:"post",data:{keyWords:e,startPage:t,maxPage:a,startTime:r,endTime:s,sort:n}}).then(l["a"].handler)}function u({name:e}){return Object(i["a"])({url:"/taskGroup/create",method:"post",data:{name:e}}).then(l["a"].handler)}function h({ids:e}){return Object(i["a"])({url:"/taskGroup/delete",method:"delete",data:[...e]}).then(l["a"].handler)}function p({ids:e}){return Object(i["a"])({url:"/taskGroup/download",method:"get",params:{ids:e}}).then(l["a"].handler)}var m={getGroupById:c,getGroups:d,createGroup:u,deleteGroup:h,download:p},f=a("5042"),g=a("5a04");function k(e){return e.map(e=>{e.createTime=f["a"].format(new Date(e.createTime),"yyyy-MM-dd hh:mm:ss"),delete e.deleted,e.createTime=f["a"].format(new Date(e.createTime),"yyyy-MM-dd hh:mm:ss");let t=[];e.orders&&(t=e.orders.map(e=>{if(null===e.id)return null;e.status="complete"===e.status?"已成功":"未成功",null===e.files&&(e.files=[]),e.createTime=f["a"].format(new Date(e.createTime),"yyyy-MM-dd hh:mm:ss");let{id:t,status:a,fee:r,title:n,serialNumber:o,createTime:i,url:l,size:c,resolution:d,taskId:u,result:h,fileName:p,files:m}=e;return l&&-1===l.indexOf("http")&&-1===l.indexOf("//")&&(l="//"+l),null!==m&&(m=m.map(e=>{if(null===e)return null;let{id:t,name:a,taskId:r,size:s,createTime:n,orderId:o}=e;return new g["a"]({id:t,name:a,taskId:r,size:s,createTime:n,orderId:o})})),new s["a"]({id:t,status:a,fee:r,title:n,serialNumber:o,createTime:i,url:l,size:c,resolution:d,taskId:u,result:h,fileName:p,files:m})}),t=t.filter(e=>Boolean(e)&&Boolean(e.id)));let{id:a,name:n,createTime:o}=e;return new r["a"]({id:a,name:n,createTime:o,orders:t})})}async function w(e=1,t=5,a="",r="",s="",n="desc"){const i=await m.getGroups({endTime:s,startTime:r,keyWords:a,startPages:e,maxPages:t,sort:n});let{records:l,total:c,size:d,current:u,pages:h}=i.data;return new o(k(l),c,d,u,h)}async function b({taskId:e}){const t=await m.getGroupById({groupId:e});let{records:a,total:r,size:s,current:n,pages:o}=t.data;return k(a)[0]}async function y(e){m.deleteGroup({ids:e})}async function T(e){return m.download({ids:e})}async function I({name:e}){return m.createGroup({name:e})}t["a"]={delTaskByIds:y,getAll:w,download:T,addTaskGroup:I,find:b}},ce79:function(e,t,a){"use strict";a("5a04");class r{constructor({id:e,status:t,fee:a,title:r,serialNumber:s,createTime:n,url:o,size:i,resolution:l,taskId:c,result:d,fileName:u,files:h=[]}){this.id=e,this.status=t,this.fee=a,this.title=r,this.serialNumber=s,this.createTime=n,this.url=o,this.size=i,this.resolution=l,this.taskId=c,this.resolution=l,this.result=d,this.fileName=u,this.files=h}}t["a"]=r},d832:function(e,t,a){"use strict";a("6f08")}}]);
//# sourceMappingURL=chunk-b04c1d4a.035002fa.js.map